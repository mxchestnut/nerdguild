---
// Fundations
import Text from "@/components/fundations/elements/Text.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
// Posts
import { getPostsByCategory, formatDate } from "@/lib/posts";

const posts = await getPostsByCategory('Roots & Reach', 6);
const rootsReachPosts = posts.map(post => ({
  date: formatDate(post.data.publishedAt),
  title: post.data.title,
  description: post.data.description,
  category: post.data.category,
  slug: post.slug,
  content: post.body,
  tags: post.data.tags || [],
}));
---

<section class="scroll-mt-32" id="roots-reach">
  <Wrapper variant="standard" class="py-12 lg:py-24">
    <div class="grid grid-cols-1 lg:grid-cols-4 items-start">
      <div class="lg:col-start-2">
        <Text tag="p" variant="textSM" class="text-base-600 dark:text-base-300"
          >Latest Posts
          <br />
          Category</Text
        >
      </div>
      <Text
        tag="h2"
        variant="textXL"
        class="font-semibold leading-snug text-left tracking-tighter lg:col-span-2 text-base-900 dark:text-white"
      >
        Roots & Reach
      </Text>
    </div>

    <div class="flex flex-col gap-12 mt-8">
      {
        rootsReachPosts.map((post, index) => (
          <article class="py-12 border-t border-base-200 dark:border-base-800">
            <div class="grid grid-cols-1 gap-4 lg:grid-cols-4 items-start">
              <Text
                tag="p"
                variant="textXS"
                class="text-base-600 dark:text-base-300 uppercase"
              >
                {post.date}
              </Text>
              <Text
                tag="h3"
                variant="displaySM"
                class="text-base-900 dark:text-white leading-tight font-semibold"
              >
                <button 
                  type="button"
                  class="text-left hover:opacity-70 transition-opacity cursor-pointer w-full accordion-trigger"
                  data-post-id={`roots-reach-${index}`}
                >
                  {post.title}
                </button>
              </Text>
              <Text
                tag="p"
                variant="textSM"
                class="text-base-600 dark:text-base-300"
              >
                {post.description}
              </Text>
              <div class="flex flex-wrap gap-2 lg:col-start-4">
                {post.tags.map((tag) => (
                  <Text
                    tag="span"
                    variant="textXS"
                    class="text-base-600 dark:text-base-300 uppercase px-2 py-1 bg-base-100 dark:bg-base-800 rounded"
                  >
                    {tag}
                  </Text>
                ))}
              </div>
            </div>
            <div 
              class="accordion-content mt-8 overflow-hidden transition-all duration-300" 
              data-post-id={`roots-reach-${index}`}
              style="max-height: 0;"
            >
              <div class="prose prose-base dark:prose-invert max-w-none lg:col-start-2 lg:col-span-2 lg:ml-[calc(25%)]">
                <div set:html={post.content} />
              </div>
            </div>
          </article>
        ))
      }
    </div>
  </Wrapper>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const triggers = document.querySelectorAll('.accordion-trigger');
    
    triggers.forEach(trigger => {
      trigger.addEventListener('click', () => {
        const postId = trigger.getAttribute('data-post-id');
        const content = document.querySelector(`.accordion-content[data-post-id="${postId}"]`);
        
        if (content) {
          const isOpen = content.style.maxHeight && content.style.maxHeight !== '0px';
          
          if (isOpen) {
            content.style.maxHeight = '0';
          } else {
            content.style.maxHeight = content.scrollHeight + 'px';
          }
        }
      });
    });
  });
</script>
