---
// Fundations
import Text from "@/components/fundations/elements/Text.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
// Posts
import { getAllPosts, formatDate } from "@/lib/posts";

// Fetch all posts
const posts = await getAllPosts();
const allPosts = await Promise.all(
  posts.slice(0, 6).map(async (post) => {
    const { Content } = await post.render();
    return {
      date: formatDate(post.data.publishedAt),
      title: post.data.title,
      description: post.data.description,
      category: post.data.category,
      slug: post.slug,
      Content,
    };
  })
);
---

<section class="scroll-mt-32" id="all">
  <Wrapper variant="standard" class="py-12 lg:py-24">
    <div class="flex flex-col gap-12">
      {
        allPosts.map((post, index) => (
          <article class="py-12 border-t border-base-200 dark:border-base-800">
            <div class="grid grid-cols-1 gap-4 lg:grid-cols-4 items-start">
              <Text
                tag="p"
                variant="textXS"
                class="text-base-600 dark:text-base-300 uppercase"
              >
                {post.date}
              </Text>
              <Text
                tag="h3"
                variant="displaySM"
                class="text-base-900 dark:text-white leading-tight font-semibold"
              >
                <button 
                  type="button"
                  class="text-left hover:opacity-70 transition-opacity cursor-pointer w-full accordion-trigger"
                  data-post-id={`all-${index}`}
                >
                  {post.title}
                </button>
              </Text>
              <Text
                tag="p"
                variant="textSM"
                class="text-base-600 dark:text-base-300"
              >
                {post.description}
              </Text>
              <Text
                tag="p"
                variant="textXS"
                class="text-base-600 dark:text-base-300 uppercase lg:ml-auto lg:col-start-4"
              >
                {post.category}
              </Text>
            </div>
            <div 
              class="accordion-content mt-8 overflow-hidden transition-all duration-300" 
              data-post-id={`all-${index}`}
              style="max-height: 0;"
            >
              <div class="prose prose-base dark:prose-invert max-w-none">
                <post.Content />
              </div>
              </div>
            </div>
          </article>
        ))
      }
    </div>
  </Wrapper>
</section>
